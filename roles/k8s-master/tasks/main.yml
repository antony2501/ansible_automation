- name: Init cluster
  command: >
    kubeadm init
    --pod-network-cidr={{ pod_cidr }}
  args:
    creates: /etc/kubernetes/admin.conf

- name: Setup kubeconfig
  shell: |
    mkdir -p /home/ubuntu/.kube
    cp /etc/kubernetes/admin.conf /home/ubuntu/.kube/config
    chown ubuntu:ubuntu /home/ubuntu/.kube/config

- name: Install Flannel
  become_user: ubuntu
  command: kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
